# =============================================================================
# VECTOR DATABASE BENCHMARK - DOCKER COMPOSE
# Author: Cihat Özkurt
# Project: Comprehensive Benchmarking of Vector Databases for Chatbot Applications
# Master's Thesis - TH Köln
# =============================================================================
#
# Usage:
#   Start all services:     docker-compose up -d
#   Stop all services:      docker-compose down
#   View logs:              docker-compose logs -f
#   Rebuild after changes:  docker-compose up -d --build
#
# Access Points:
#   - Jupyter Lab:    http://localhost:8888
#   - Qdrant:         http://localhost:6333
#   - Weaviate:       http://localhost:8080
# =============================================================================

version: '3.8'

services:
  # ===========================================================================
  # JUPYTER LAB - Main Benchmark Environment
  # ===========================================================================
  jupyter:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: vectordb-benchmark
    ports:
      - "8888:8888"
    volumes:
      - ./data:/app/data
      - ./notebooks:/app/notebooks
      - ./results:/app/results
    environment:
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333
      - WEAVIATE_HOST=weaviate
      - WEAVIATE_PORT=8080
    depends_on:
      - qdrant
      - weaviate
    networks:
      - vectordb-network

  # ===========================================================================
  # QDRANT - Vector Search Engine
  # ===========================================================================
  qdrant:
    image: qdrant/qdrant:v1.7.4
    container_name: qdrant
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant_storage:/qdrant/storage
    environment:
      - QDRANT__SERVICE__GRPC_PORT=6334
    networks:
      - vectordb-network

  # ===========================================================================
  # WEAVIATE - Vector Database
  # ===========================================================================
  weaviate:
    image: cr.weaviate.io/semitechnologies/weaviate:1.27.1
    container_name: weaviate
    ports:
      - "8080:8080"
      - "50051:50051"
    volumes:
      - weaviate_data:/var/lib/weaviate
    environment:
      QUERY_DEFAULTS_LIMIT: 25
      AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED: 'true'
      PERSISTENCE_DATA_PATH: '/var/lib/weaviate'
      DEFAULT_VECTORIZER_MODULE: 'none'
      ENABLE_MODULES: ''
      CLUSTER_HOSTNAME: 'node1'
    networks:
      - vectordb-network

# =============================================================================
# NETWORKS
# =============================================================================
networks:
  vectordb-network:
    driver: bridge

# =============================================================================
# VOLUMES
# =============================================================================
volumes:
  qdrant_storage:
  weaviate_data:
